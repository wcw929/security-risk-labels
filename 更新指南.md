# 安全风险标签展示插件 - 在线更新指南

## 功能概述

本插件现已支持在线更新功能，可以自动检查新版本并提醒用户更新，确保所有安装了插件的用户都能及时获得最新功能和修复。

## 更新机制

### 自动检查
- **定时检查**: 插件每24小时自动检查一次更新
- **启动检查**: 浏览器启动时会检查更新
- **智能提醒**: 发现新版本时会显示系统通知

### 手动检查
- 点击插件窗口标题栏的 🔄 按钮可手动检查更新
- 检查过程中按钮会显示 ⏳ 状态
- 检查完成后会显示结果提示

## 配置说明

### 1. GitHub仓库配置

在 `background.js` 文件中修改以下配置：

```javascript
const UPDATE_CONFIG = {
  // 替换为你的GitHub仓库信息
  GITHUB_REPO: 'your-username/your-repo-name', // 例如: 'zhangsan/risk-label-plugin'
  CHECK_INTERVAL: 24 * 60 * 60 * 1000, // 检查间隔（毫秒）
  UPDATE_URL_TEMPLATE: 'https://github.com/{repo}/releases/latest',
  API_URL_TEMPLATE: 'https://api.github.com/repos/{repo}/releases/latest'
};
```

### 2. 版本号规范

插件使用语义化版本号（Semantic Versioning），格式为 `主版本号.次版本号.修订号`：

- **主版本号**: 不兼容的API修改
- **次版本号**: 向下兼容的功能性新增
- **修订号**: 向下兼容的问题修正

示例：`1.0.0` → `1.1.0` → `1.1.1` → `2.0.0`

### 3. 发布新版本

#### 步骤1: 更新版本号
在 `manifest.json` 中更新版本号：
```json
{
  "version": "1.1.0"
}
```

#### 步骤2: 创建GitHub Release
1. 在GitHub仓库页面点击 "Releases"
2. 点击 "Create a new release"
3. 填写标签版本（如 `v1.1.0`）
4. 填写发布标题和更新说明
5. 上传插件文件（zip格式）
6. 点击 "Publish release"

#### 步骤3: 验证更新
- 用户会在24小时内收到更新通知
- 或者用户可以手动点击更新按钮检查

## 用户体验

### 更新通知
当有新版本时，用户会看到：
1. **系统通知**: 浏览器右下角弹出通知
2. **更新弹窗**: 详细的版本信息和更新内容
3. **一键更新**: 点击按钮直接跳转到下载页面

### 更新流程
1. 用户收到更新通知
2. 点击"立即更新"按钮
3. 跳转到GitHub Release页面
4. 下载最新版本的插件文件
5. 在Chrome扩展管理页面更新插件

## 高级配置

### 自定义检查间隔
修改 `CHECK_INTERVAL` 值来调整检查频率：
```javascript
CHECK_INTERVAL: 12 * 60 * 60 * 1000, // 12小时检查一次
```

### 自定义更新服务器
如果不使用GitHub，可以修改API地址：
```javascript
API_URL_TEMPLATE: 'https://your-server.com/api/releases/latest'
```

API需要返回以下格式的JSON：
```json
{
  "tag_name": "v1.1.0",
  "body": "更新内容说明",
  "published_at": "2024-01-01T00:00:00Z"
}
```

### 禁用自动检查
如果只想手动检查更新，可以设置：
```javascript
CHECK_INTERVAL: Infinity, // 禁用自动检查
```

## 故障排除

### 常见问题

**Q: 检查更新失败怎么办？**
A: 检查网络连接和GitHub仓库配置是否正确。

**Q: 没有收到更新通知？**
A: 确保浏览器允许插件显示通知，检查通知权限设置。

**Q: 版本比较不正确？**
A: 确保版本号遵循语义化版本规范，不要包含额外字符。

**Q: 如何查看更新日志？**
A: 打开浏览器开发者工具，查看Console标签页的日志信息。

### 调试模式
在开发者工具Console中运行以下命令来手动触发更新检查：
```javascript
chrome.runtime.sendMessage({ action: 'checkUpdate' }, console.log);
```

## 安全说明

- 插件只检查版本信息，不会自动下载或安装文件
- 所有更新都需要用户手动确认
- 使用HTTPS连接确保通信安全
- 不会收集或传输用户数据

## 最佳实践

1. **定期发布**: 建议每月至少发布一次更新
2. **详细说明**: 在Release中详细描述更新内容
3. **测试验证**: 发布前充分测试新版本
4. **向下兼容**: 尽量保持API向下兼容
5. **安全更新**: 及时修复安全问题并发布更新

## 技术支持

如果在使用更新功能时遇到问题，请：
1. 查看浏览器控制台错误信息
2. 检查网络连接和权限设置
3. 验证GitHub仓库配置
4. 联系开发团队获取支持

---

**注意**: 首次配置完成后，建议创建一个测试版本来验证更新功能是否正常工作。
